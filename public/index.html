<!doctype html>
<html lang="en" class="h-full bg-slate-950">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Predictor Studio</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full text-slate-100 font-sans antialiased selection:bg-emerald-500/30">
  <main class="min-h-full bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-slate-950">
    <div class="mx-auto max-w-6xl px-6 py-12">
      <div class="flex items-center justify-between mb-12 border-b border-slate-800 pb-6">
        <div>
          <h1 class="text-3xl font-bold tracking-tight text-white">Stock Prediction Model by <a href="https://haripatel788.github.io/" class="underline hover:text-emerald-400">Hari Patel</a></h1>
          <p class="mt-2 text-slate-400">Machine Learning Forecasting Pipeline</p>
        </div>
      </div>

      <section class="grid gap-8 lg:grid-cols-12">
        <div class="lg:col-span-4 space-y-6">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/50 p-6 shadow-xl backdrop-blur-sm">
            <h2 class="text-lg font-semibold text-white mb-6 flex items-center gap-2">
              <svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
              Configuration
            </h2>
            <form id="predict-form" class="space-y-6">
              <div>
                <label for="symbol" class="block text-sm font-medium text-slate-400 mb-2">Ticker Symbol</label>
                <input id="symbol" name="symbol" required placeholder="AAPL" class="w-full rounded-lg border border-slate-700 bg-slate-950 px-4 py-3 text-white placeholder-slate-600 focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition uppercase font-mono" />
              </div>
              <div>
                <label for="horizon" class="block text-sm font-medium text-slate-400 mb-2">Forecast Horizon (Days)</label>
                <div class="relative">
                  <input id="horizon" name="horizon" type="number" min="1" max="30" value="7" required class="w-full rounded-lg border border-slate-700 bg-slate-950 px-4 py-3 text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition font-mono" />
                </div>
              </div>
              <button id="submit-btn" type="submit" class="w-full rounded-lg bg-emerald-600 px-4 py-3.5 text-sm font-semibold text-white hover:bg-emerald-500 transition shadow-lg shadow-emerald-900/20 disabled:opacity-70 disabled:cursor-not-allowed">
                Generate Forecast
              </button>
            </form>
            <div id="error" class="mt-4 hidden rounded-lg border border-red-500/20 bg-red-500/10 p-4 text-sm text-red-300"></div>
          </div>
          
          <div class="rounded-xl border border-slate-800 bg-slate-900/30 p-4">
            <h3 class="text-xs font-semibold uppercase tracking-wider text-slate-500 mb-3">Supported Assets</h3>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 rounded bg-slate-800 text-xs text-slate-400 border border-slate-700">Any Stock with a valid Ticker Symbol</span>
            </div>
          </div>
        </div>

        <div class="lg:col-span-8">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/50 shadow-xl backdrop-blur-sm h-full min-h-[400px] flex flex-col">
            <div class="p-6 border-b border-slate-800 flex items-center justify-between">
              <h2 class="text-lg font-semibold text-white">Analysis Results</h2>
              <span id="data-source" class="text-xs text-slate-500 font-mono hidden"></span>
            </div>
            
            <div id="result" class="hidden flex-1 p-6">
              <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                <div class="p-4 rounded-xl bg-slate-950 border border-slate-800">
                  <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">Target Ticker</p>
                  <p id="summary-symbol" class="text-xl font-bold text-white font-mono"></p>
                </div>
                <div class="p-4 rounded-xl bg-slate-950 border border-slate-800">
                  <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">Latest Price</p>
                  <p id="summary-last" class="text-xl font-bold text-emerald-400 font-mono"></p>
                </div>
                <div class="p-4 rounded-xl bg-slate-950 border border-slate-800 col-span-2 md:col-span-1">
                  <p class="text-xs text-slate-500 uppercase tracking-wider mb-1">1-Day Holdout MAE</p>
                  <p id="summary-mae" class="text-xl font-bold text-blue-400 font-mono"></p>
                </div>
              </div>

              <div class="rounded-xl border border-slate-800 overflow-hidden">
                <table class="w-full text-left text-sm">
                  <thead class="bg-slate-950 text-slate-400 border-b border-slate-800">
                    <tr>
                      <th class="px-6 py-4 font-semibold">Forecast Date</th>
                      <th class="px-6 py-4 font-semibold text-right">Predicted Price</th>
                    </tr>
                  </thead>
                  <tbody id="forecast-body" class="divide-y divide-slate-800 bg-slate-950/30 text-slate-300"></tbody>
                </table>
              </div>
            </div>

            <div id="empty-state" class="flex-1 flex flex-col items-center justify-center p-12 text-center">
              <div class="w-16 h-16 rounded-full bg-slate-800/50 flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
              </div>
              <h3 class="text-lg font-medium text-white">No Forecast Generated</h3>
              <p class="text-slate-500 mt-2 max-w-sm">Enter a valid ticker symbol and prediction horizon to start the machine learning inference engine.</p>
            </div>
            
            <div id="loader" class="hidden flex-1 flex flex-col items-center justify-center p-12">
              <div class="w-10 h-10 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin mb-4"></div>
              <p class="text-emerald-400 font-mono text-sm animate-pulse">Training Model & Generating Inference...</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    const form = document.getElementById('predict-form');
    const submitBtn = document.getElementById('submit-btn');
    const errorBox = document.getElementById('error');
    const resultBox = document.getElementById('result');
    const emptyState = document.getElementById('empty-state');
    const loader = document.getElementById('loader');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      errorBox.classList.add('hidden');
      resultBox.classList.add('hidden');
      emptyState.classList.add('hidden');
      loader.classList.remove('hidden');
      submitBtn.disabled = true;
      submitBtn.innerText = "Processing...";

      const symbol = document.getElementById('symbol').value;
      const horizon_days = Number(document.getElementById('horizon').value);

      try {
        const response = await fetch('/api/predict', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ symbol, horizon_days })
        });

        const data = await response.json().catch(() => null);

        if (!response.ok || !data) {
          throw new Error(data?.detail || `Server error: ${response.status}`);
        }

        document.getElementById('summary-symbol').textContent = data.symbol;
        document.getElementById('summary-last').textContent = `$${data.last_close.toFixed(2)}`;
        document.getElementById('summary-mae').textContent = `$${data.model_mae.toFixed(2)} (${data.model_mae_pct.toFixed(2)}%)`;
        document.getElementById('data-source').textContent = `Source: ${data.data_source} | Baseline MAE: $${data.baseline_mae.toFixed(2)}`;
        document.getElementById('data-source').classList.remove('hidden');

        const tbody = document.getElementById('forecast-body');
        tbody.innerHTML = data.predicted_dates.map((date, i) => `
          <tr class="hover:bg-slate-800/50 transition-colors">
            <td class="px-6 py-4 font-mono text-slate-300">${date}</td>
            <td class="px-6 py-4 text-right font-mono text-emerald-400 font-bold">$${data.predicted_prices[i].toFixed(2)}</td>
          </tr>
        `).join('');

        loader.classList.add('hidden');
        resultBox.classList.remove('hidden');

      } catch (err) {
        loader.classList.add('hidden');
        errorBox.textContent = err.message;
        errorBox.classList.remove('hidden');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerText = "Generate Forecast";
      }
    });
  </script>
</body>
</html>
